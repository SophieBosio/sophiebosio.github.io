<!DOCTYPE html>
<html lang="en" dir="auto">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Demystifying Monads - Part 1/3 | Sophie Bosio</title>
<meta name="keywords" content="functionalprogramming, haskell, monads">
<meta name="description" content="Zachary Tellman opens his book Elements of Clojure by explaining the concept of tacit knowledge. Paraphrasing, it&rsquo;s all the innate/implicit/subconscious knowledge that we have acquired through experience and, because we didn&rsquo;t learn it in a straightforward manner ourselves, often struggle to explain clearly to others. The result is that others, too, have to go through a frustrating and non-linear process to learn it.
I think this is what often happens with monads, which mystify and confuse a lot of people. If they&rsquo;re like me, it&rsquo;s because they&rsquo;re ambushed by it while checking out a purely functional language like Haskell for the first time.">
<meta name="author" content="Sophie Adeline Solheim Bosio">
<link rel="canonical" href="http://localhost:1313/posts/demystifying-monads-1/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.fc220c15db4aef0318bbf30adc45d33d4d7c88deff3238b23eb255afdc472ca6.css" integrity="sha256-/CIMFdtK7wMYu/MK3EXTPU18iN7/MjiyPrJVr9xHLKY=" rel="preload stylesheet" as="style">
<link rel="icon" href="http://localhost:1313/static/img/favicon.png">
<link rel="icon" type="image/png" sizes="16x16" href="http://localhost:1313/static/img/favicon.png">
<link rel="icon" type="image/png" sizes="32x32" href="http://localhost:1313/static/img/favicon.png">
<link rel="apple-touch-icon" href="http://localhost:1313/static/img/favicon.png">
<link rel="mask-icon" href="http://localhost:1313/static/img/favicon.png">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="http://localhost:1313/posts/demystifying-monads-1/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript><meta property="og:title" content="Demystifying Monads - Part 1/3" />
<meta property="og:description" content="Zachary Tellman opens his book Elements of Clojure by explaining the concept of tacit knowledge. Paraphrasing, it&rsquo;s all the innate/implicit/subconscious knowledge that we have acquired through experience and, because we didn&rsquo;t learn it in a straightforward manner ourselves, often struggle to explain clearly to others. The result is that others, too, have to go through a frustrating and non-linear process to learn it.
I think this is what often happens with monads, which mystify and confuse a lot of people. If they&rsquo;re like me, it&rsquo;s because they&rsquo;re ambushed by it while checking out a purely functional language like Haskell for the first time." />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://localhost:1313/posts/demystifying-monads-1/" /><meta property="article:section" content="posts" />



<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Demystifying Monads - Part 1/3"/>
<meta name="twitter:description" content="Zachary Tellman opens his book Elements of Clojure by explaining the concept of tacit knowledge. Paraphrasing, it&rsquo;s all the innate/implicit/subconscious knowledge that we have acquired through experience and, because we didn&rsquo;t learn it in a straightforward manner ourselves, often struggle to explain clearly to others. The result is that others, too, have to go through a frustrating and non-linear process to learn it.
I think this is what often happens with monads, which mystify and confuse a lot of people. If they&rsquo;re like me, it&rsquo;s because they&rsquo;re ambushed by it while checking out a purely functional language like Haskell for the first time."/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "http://localhost:1313/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "Demystifying Monads - Part 1/3",
      "item": "http://localhost:1313/posts/demystifying-monads-1/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Demystifying Monads - Part 1/3",
  "name": "Demystifying Monads - Part 1\/3",
  "description": "Zachary Tellman opens his book Elements of Clojure by explaining the concept of tacit knowledge. Paraphrasing, it\u0026rsquo;s all the innate/implicit/subconscious knowledge that we have acquired through experience and, because we didn\u0026rsquo;t learn it in a straightforward manner ourselves, often struggle to explain clearly to others. The result is that others, too, have to go through a frustrating and non-linear process to learn it.\nI think this is what often happens with monads, which mystify and confuse a lot of people. If they\u0026rsquo;re like me, it\u0026rsquo;s because they\u0026rsquo;re ambushed by it while checking out a purely functional language like Haskell for the first time.\n",
  "keywords": [
    "functionalprogramming", "haskell", "monads"
  ],
  "articleBody": "Zachary Tellman opens his book Elements of Clojure by explaining the concept of tacit knowledge. Paraphrasing, it’s all the innate/implicit/subconscious knowledge that we have acquired through experience and, because we didn’t learn it in a straightforward manner ourselves, often struggle to explain clearly to others. The result is that others, too, have to go through a frustrating and non-linear process to learn it.\nI think this is what often happens with monads, which mystify and confuse a lot of people. If they’re like me, it’s because they’re ambushed by it while checking out a purely functional language like Haskell for the first time.\nMaybe they get curious about it, but Googling the topic leaves them just as confused – many of the explanations found are either terminology-heavy or overly simplified. Typically definitions range between “a monad is a monoid in the category of endofunctors” on one end and “a burrito!” on the other. Neither is particularly helpful for learners.\nI think this happens because people who understand monads struggle to communicate their tacit knowledge, which leads to people trying to learn becoming frustrated!\nAnd that’s a shame. I think we should be able to teach and learn about monads without this much pain. I won’t pretend I understand monads completely (for example, I haven’t looked into their applications in mathematics), but the way we tend to use monads in computer science isn’t all that crazy. So in this blog series, we’ll have a closer look at the humble monad.\nI personally feel a need to know where a concept came from and why I should bother with it. So in this first part, I’ll cover some of the theory behind monads. In Part 2, we’ll roll up our shirt sleeves, incrementally implement our own monad, and finally see that theory in action. Finally, in Part 3, we’ll implement a couple of famous monads for fun and I’ll provide some resources for further reading.\nIf you’re just interested in the application of monads or you’re already familiar with the theory, then you have my blessing to jump right to Part 2. Otherwise, let’s dive in!\nWhat is a Monad? The monad is a concept from a formalism called category theory.\nJust like set theory, category theory has applications in both mathematics and computer science. Category theory is the study of mathematical structures. Informally speaking, the category theorist wants to know:\nIf different mathematical concepts have similarities, what are their commonalities? Can we make out the general, shared structure? What properties does this generalised structure have? How are different generalised structures related to one another? This all sounds abstract because it is. Category theory is sometimes referred to as the “mathematics of mathematics”. But here, we’ll just dip our toes into the stuff I think is useful to us right now, and the rest you can read about later if you’re interested.\nNow, when we prove a property of a generalised structure, that property holds true for all the specific cases, too. Turns out this is really useful! And a lot of the mathematical concepts we use in programming are specific cases like these.\nAs you might already have guessed, monads are one of these general structures that we actually use all the time. For example, lists are monads! Consider that a teaser for Part 3.\nOkay, now we’ve covered some theoretical grounds. Before we jump into more theory, I think now is a good time to explain why we’re even interested in monads in the first place. They’re not just a source of factoids about things we already know how to use, like lists, but a pretty neat design pattern that we can use to structure our code.\nPure Functions (Or, Why Use Monads?) The need for monads (or some alternative) is mostly in purely functional programming languages. This being said, monads are language agnostic and can be used to great effect regardless. A monad in Haskell is the same as a monad in Typescript.\nBut back to our motivation.\nA purely functional programming language only allows you to write pure functions. There are many equivalent ways of defining pure functions. I find it useful to think of it as a mapping between outputs and inputs: Each input is mapped to one and only one output, and the function does nothing else. The function is defined entirely by its definition – nothing else can affect what the function does.\nThe fact that calling a function on a given input returns the same output every time you call it, is called referential transparency. It means that anywhere in your code, you can replace a given function call with its result and vice versa without changing the semantics of your code.\n-- This program \"I'm \" ++ show (99 + 1) ++ \" years old!\" -- is exactly equivalent to this program \"I'm \" ++ show 100 ++ \" years old!\" But, borrowing an example from Tellman, if we have a strange definition of + that first sends out an email and then adds our two numbers together, the two programs above aren’t equivalent anymore!\nPure functions therefore cannot perform side-effects, such as sending emails or generally, reading from or writing to a mutable variable/state/context.\nI cannot call a function on Monday and get one result, then call it on Tuesday and get a different result because a variable changed in the meantime.\n-- 'punctuation' is a variable defined elsewhere ageInfo age = \"I'm \" ++ age ++ \" years old\" ++ punctuation -- On Monday: ghci\u003e ageInfo 100 \"I'm 100 years old!\" -- On Tuesday: ghci\u003e ageInfo 100 \"I'm 100 years old???\" Another way to say this, is that a pure function cannot have any side effects. These include things like updating a mutable variable, but also reading from and writing to the terminal.\nA read from the terminal is a function call that receives some of its input at runtime and the exact same program may return different results. The definition of the function does therefore not define its behaviour completely – it also depends on non-deterministic user input. Just like reading from a mutable variable, this breaks the rules.\ngreet = do name \u003c- getLine -- Read a line of input, save in the variable 'name' putStrLn \"Hello, \" ++ name -- Print greeting with supplied 'name' -- Alice is using the computer: ghci\u003e greet Alice -- User inputs \"Alice\" Hello, Alice -- Bella is using the computer: ghci\u003e greet \"Bella\" Bella -- User inputs \"Bella\" Hello, Bella A write to the terminal appends line(s) of text to the bottom of whatever text was there before. Therefore, writing to the terminal is like updating an existing, mutable variable. Therefore, its behaviour depends on the current state of the terminal output and will change between calls. Also illegal!\nJust like a function call that returns a value can be replaced with that value, a pure function definition can be replaced with its definition. In other words, pure functions are immutable declarations that we can safely use in and compose with other pure functions. Therefore, a pure function can use other pure functions. The programs below are equivalent.\ncompute x = ((2 * x) + 40) -- is equivalent to double x = (2 * x) compute x = (double x) + 40 -- is equivalent to double x = (2 * x) plusForty x = x + 40 compute = plusForty . double -- Read \"plusForty\" after \"double\" But the second we use an impure function in our chain of pure functions, the whole thing becomes impure.\nAll this function purity may sound a bit restrictive, but it makes it super easy to reason about our code and to test it. Because each small function is a simple mapping from input to output, we can compose functions with confidence and quickly experiment or write tests to check that our function actually does what we expect. Composition is the core of functional programming!\nWe prefer to use pure functions as much as possible. The “meat” of our program should preferably consist of concise, pure functions that we compose to get bigger and more complex, pure functions. But at some point, we need to deal with stateful computation. Either because of the domain we’re dealing with or simply because we want to print to the terminal!\nThis is where monads come in: We can use monads to model stateful computations in a purely functional way!\nThe Case For Monads For now, you can think of a monad as a strict interface that defines how you can read from/write to state in your computations. The monad defines what operations are permissible and how to chain together stateful computations.\nNow, if we can use monads to perform stateful computations, then we can break the guarantees that functional programming gives us (confidence and composability) so why not just use an imperative language with mutable variables?\nMonads deal with immutable data structures and define explicitly wh\nA Taste of Category Theory ",
  "wordCount" : "1504",
  "inLanguage": "en",
  "datePublished": "0001-01-01T00:00:00Z",
  "dateModified": "0001-01-01T00:00:00Z",
  "author":[{
    "@type": "Person",
    "name": "Sophie Adeline Solheim Bosio"
  }],
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "http://localhost:1313/posts/demystifying-monads-1/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Sophie Bosio",
    "logo": {
      "@type": "ImageObject",
      "url": "http://localhost:1313/static/img/favicon.png"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="http://localhost:1313/" accesskey="h" title="Sophie Bosio (Alt + H)">Sophie Bosio</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="http://localhost:1313/about" title="About">
                    <span>About</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/education" title="Education">
                    <span>Education</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/search/" title="Search (Alt &#43; /)" accesskey=/>
                    <span>Search</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/tags/" title="Tags">
                    <span>Tags</span>
                </a>
            </li>
            <li>
                <a href="https://github.com/SophieBosio" title="GitHub">
                    <span>GitHub</span>&nbsp;
                    <svg fill="none" shape-rendering="geometricPrecision" stroke="currentColor" stroke-linecap="round"
                        stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12">
                        <path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"></path>
                        <path d="M15 3h6v6"></path>
                        <path d="M10 14L21 3"></path>
                    </svg>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="http://localhost:1313/">Home</a>&nbsp;»&nbsp;<a href="http://localhost:1313/posts/">Posts</a></div>
    <h1 class="post-title entry-hint-parent">
      Demystifying Monads - Part 1/3
      <span class="entry-hint" title="Draft">
        <svg xmlns="http://www.w3.org/2000/svg" height="35" viewBox="0 -960 960 960" fill="currentColor">
          <path
            d="M160-410v-60h300v60H160Zm0-165v-60h470v60H160Zm0-165v-60h470v60H160Zm360 580v-123l221-220q9-9 20-13t22-4q12 0 23 4.5t20 13.5l37 37q9 9 13 20t4 22q0 11-4.5 22.5T862.09-380L643-160H520Zm300-263-37-37 37 37ZM580-220h38l121-122-18-19-19-18-122 121v38Zm141-141-19-18 37 37-18-19Z" />
        </svg>
      </span>
    </h1>
    <div class="post-meta">8 min&nbsp;·&nbsp;Sophie Adeline Solheim Bosio

</div>
  </header> <div class="toc">
    <details >
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#what-is-a-monad" aria-label="What is a Monad?">What is a Monad?</a></li>
                <li>
                    <a href="#pure-functions--or-why-use-monads" aria-label="Pure Functions (Or, Why Use Monads?)">Pure Functions (Or, Why Use Monads?)</a></li>
                <li>
                    <a href="#the-case-for-monads" aria-label="The Case For Monads">The Case For Monads</a></li>
                <li>
                    <a href="#a-taste-of-category-theory" aria-label="A Taste of Category Theory">A Taste of Category Theory</a>
                </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><p>Zachary Tellman opens his book <em>Elements of Clojure</em> by explaining the concept of <em>tacit knowledge</em>. Paraphrasing, it&rsquo;s all the innate/implicit/subconscious knowledge that we have acquired through experience and, because we didn&rsquo;t learn it in a straightforward manner ourselves, often struggle to explain clearly to others. The result is that others, too, have to go through a frustrating and non-linear process to learn it.</p>
<p>I think this is what often happens with monads, which mystify and confuse a lot of people. If they&rsquo;re like me, it&rsquo;s because they&rsquo;re ambushed by it while checking out a purely functional language like Haskell for the first time.</p>
<p>Maybe they get curious about it, but Googling the topic leaves them just as confused &ndash; many of the explanations found are either terminology-heavy or overly simplified. Typically definitions range between &ldquo;a monad is a monoid in the category of endofunctors&rdquo; on one end and &ldquo;a burrito!&rdquo; on the other. Neither is particularly helpful for learners.</p>
<p>I think this happens because people who understand monads struggle to communicate their tacit knowledge, which leads to people trying to learn becoming frustrated!</p>
<p>And that&rsquo;s a shame. I think we should be able to teach and learn about monads without this much pain. I won&rsquo;t pretend I understand monads completely (for example, I haven&rsquo;t looked into their applications in mathematics), but the way we tend to use monads in computer science isn&rsquo;t all that crazy. So in this blog series, we&rsquo;ll have a closer look at the humble monad.</p>
<p>I personally feel a need to know <em>where</em> a concept came from and <em>why</em> I should bother with it. So in this first part, I&rsquo;ll cover some of the theory behind monads. In Part 2, we&rsquo;ll roll up our shirt sleeves, incrementally implement our own monad, and finally see that theory in action. Finally, in Part 3, we&rsquo;ll implement a couple of famous monads for fun and I&rsquo;ll provide some resources for further reading.</p>
<p>If you&rsquo;re just interested in the application of monads or you&rsquo;re already familiar with the theory, then you have my blessing to jump right to Part 2. Otherwise, let&rsquo;s dive in!</p>
<h2 id="what-is-a-monad">What <em>is</em> a Monad?<a hidden class="anchor" aria-hidden="true" href="#what-is-a-monad">#</a></h2>
<p>The monad is a concept from a formalism called category theory.</p>
<p>Just like set theory, category theory has applications in both mathematics and computer science. Category theory is the study of mathematical <em>structures</em>. Informally speaking, the category theorist wants to know:</p>
<ul>
<li>If different mathematical concepts have similarities, what are their commonalities? Can we make out the general, shared structure?</li>
<li>What properties does this generalised structure have?</li>
<li>How are different generalised structures related to one another?</li>
</ul>
<p>This all sounds abstract because it is. Category theory is sometimes referred to as the &ldquo;mathematics of mathematics&rdquo;. But here, we&rsquo;ll just dip our toes into the stuff I think is useful to us right now, and the rest you can read about later if you&rsquo;re interested.</p>
<p>Now, when we prove a property of a generalised structure, that property holds true for all the specific cases, too. Turns out this is really useful! And a lot of the mathematical concepts we use in programming are specific cases like these.</p>
<p>As you might already have guessed, monads are one of these general structures that we actually use all the time. For example, lists are monads! Consider that a teaser for Part 3.</p>
<p>Okay, now we&rsquo;ve covered some  theoretical grounds. Before we jump into more theory, I think now is a good time to explain why we&rsquo;re even interested in monads in the first place. They&rsquo;re not just a source of factoids about things we already know how to use, like lists, but a pretty neat design pattern that we can use to structure our code.</p>
<h2 id="pure-functions--or-why-use-monads">Pure Functions (Or, Why Use Monads?)<a hidden class="anchor" aria-hidden="true" href="#pure-functions--or-why-use-monads">#</a></h2>
<p>The <em>need</em> for monads (or some alternative) is mostly in purely functional programming languages. This being said, monads are language agnostic and can be used to great effect regardless. A monad in Haskell is the same as a monad in Typescript.</p>
<p>But back to our motivation.</p>
<p>A purely functional programming language only allows you to write <em>pure</em> functions. There are many equivalent ways of defining pure functions. I find it useful to think of it as a mapping between outputs and inputs: Each input is mapped to one and only one output, and the function does nothing else. The function is defined <em>entirely</em> by its definition &ndash; nothing else can affect what the function does.</p>
<p>The fact that calling a function on a given input returns the same output every time you call it, is called <em>referential transparency</em>. It means that anywhere in your code, you can replace a given function call with its result and vice versa without changing the semantics of your code.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-haskell" data-lang="haskell"><span class="line"><span class="cl"><span class="c1">-- This program</span>
</span></span><span class="line"><span class="cl"><span class="s">&#34;I&#39;m &#34;</span> <span class="o">++</span> <span class="n">show</span> <span class="p">(</span><span class="mi">99</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">++</span> <span class="s">&#34; years old!&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">-- is exactly equivalent to this program</span>
</span></span><span class="line"><span class="cl"><span class="s">&#34;I&#39;m &#34;</span> <span class="o">++</span> <span class="n">show</span> <span class="mi">100</span> <span class="o">++</span> <span class="s">&#34; years old!&#34;</span>
</span></span></code></pre></div><p>But, borrowing an example from Tellman, if we have a strange definition of <code>+</code> that <em>first</em> sends out an email and <em>then</em> adds our two numbers together, the two programs above aren&rsquo;t equivalent anymore!</p>
<p>Pure functions therefore cannot perform <em>side-effects</em>, such as sending emails or generally, reading from or writing to a mutable variable/state/context.</p>
<p>I cannot call a function on Monday and get one result, then call it on Tuesday and get a different result because a variable changed in the meantime.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-haskell" data-lang="haskell"><span class="line"><span class="cl"><span class="c1">-- &#39;punctuation&#39; is a variable defined elsewhere</span>
</span></span><span class="line"><span class="cl"><span class="nf">ageInfo</span> <span class="n">age</span> <span class="ow">=</span> <span class="s">&#34;I&#39;m &#34;</span> <span class="o">++</span> <span class="n">age</span> <span class="o">++</span> <span class="s">&#34; years old&#34;</span> <span class="o">++</span> <span class="n">punctuation</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">-- On Monday:</span>
</span></span><span class="line"><span class="cl"><span class="nf">ghci</span><span class="o">&gt;</span> <span class="n">ageInfo</span> <span class="mi">100</span>
</span></span><span class="line"><span class="cl"><span class="s">&#34;I&#39;m 100 years old!&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">-- On Tuesday:</span>
</span></span><span class="line"><span class="cl"><span class="nf">ghci</span><span class="o">&gt;</span> <span class="n">ageInfo</span> <span class="mi">100</span>
</span></span><span class="line"><span class="cl"><span class="s">&#34;I&#39;m 100 years old???&#34;</span>
</span></span></code></pre></div><p>Another way to say this, is that a pure function cannot have any <em>side effects</em>. These include things like updating a mutable variable, but also reading from and writing to the terminal.</p>
<p>A <strong>read</strong> from the terminal is a function call that receives some of its input at runtime and the exact same program may return different results. The definition of the function does therefore <em>not</em> define its behaviour completely &ndash; it also depends on non-deterministic user input. Just like reading from a mutable variable, this breaks the rules.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-haskell" data-lang="haskell"><span class="line"><span class="cl"><span class="nf">greet</span> <span class="ow">=</span> <span class="kr">do</span>
</span></span><span class="line"><span class="cl">  <span class="n">name</span> <span class="ow">&lt;-</span> <span class="n">getLine</span>            <span class="c1">-- Read a line of input, save in the variable &#39;name&#39;</span>
</span></span><span class="line"><span class="cl">  <span class="n">putStrLn</span> <span class="s">&#34;Hello, &#34;</span> <span class="o">++</span> <span class="n">name</span> <span class="c1">-- Print greeting with supplied &#39;name&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">-- Alice is using the computer:</span>
</span></span><span class="line"><span class="cl"><span class="nf">ghci</span><span class="o">&gt;</span> <span class="n">greet</span>
</span></span><span class="line"><span class="cl"><span class="kt">Alice</span>               <span class="c1">-- User inputs &#34;Alice&#34;</span>
</span></span><span class="line"><span class="cl"><span class="kt">Hello</span><span class="p">,</span> <span class="kt">Alice</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">-- Bella is using the computer:</span>
</span></span><span class="line"><span class="cl"><span class="nf">ghci</span><span class="o">&gt;</span> <span class="n">greet</span> <span class="s">&#34;Bella&#34;</span>
</span></span><span class="line"><span class="cl"><span class="kt">Bella</span>               <span class="c1">-- User inputs &#34;Bella&#34;</span>
</span></span><span class="line"><span class="cl"><span class="kt">Hello</span><span class="p">,</span> <span class="kt">Bella</span>
</span></span></code></pre></div><p>A <strong>write</strong> to the terminal appends line(s) of text to the bottom of whatever text was there before. Therefore, writing to the terminal is like updating an existing, mutable variable. Therefore, its behaviour depends on the current state of the terminal output and will change between calls. Also illegal!</p>
<p>Just like a function call that returns a value can be replaced with that value, a pure function definition can be replaced with its definition. In other words, pure functions are immutable declarations that we can safely use in and compose with other pure functions. Therefore, a pure function can use other pure functions. The programs below are equivalent.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-haskell" data-lang="haskell"><span class="line"><span class="cl"><span class="nf">compute</span> <span class="n">x</span> <span class="ow">=</span> <span class="p">((</span><span class="mi">2</span> <span class="o">*</span> <span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="mi">40</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">-- is equivalent to</span>
</span></span><span class="line"><span class="cl"><span class="nf">double</span>  <span class="n">x</span> <span class="ow">=</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">x</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">compute</span> <span class="n">x</span> <span class="ow">=</span> <span class="p">(</span><span class="n">double</span> <span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="mi">40</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">-- is equivalent to</span>
</span></span><span class="line"><span class="cl"><span class="nf">double</span>    <span class="n">x</span> <span class="ow">=</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">x</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">plusForty</span> <span class="n">x</span> <span class="ow">=</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">40</span>
</span></span><span class="line"><span class="cl"><span class="nf">compute</span>     <span class="ow">=</span> <span class="n">plusForty</span> <span class="o">.</span> <span class="n">double</span>  <span class="c1">-- Read &#34;plusForty&#34; after &#34;double&#34;</span>
</span></span></code></pre></div><p>But the second we use an impure function in our chain of pure functions, the whole thing becomes impure.</p>
<p>All this function purity may sound a bit restrictive, but it makes it super easy to reason about our code and to test it. Because each small function is a simple mapping from input to output, we can compose functions with confidence and quickly experiment or write tests to check that our function actually does what we expect. Composition is the core of functional programming!</p>
<p>We prefer to use pure functions as much as possible. The &ldquo;meat&rdquo; of our program should preferably consist of concise, pure functions that we compose to get bigger and more complex, pure functions. But at some point, we need to deal with stateful computation. Either because of the domain we&rsquo;re dealing with or simply because we want to print to the terminal!</p>
<p>This is where monads come in: We can use monads to model stateful computations in a purely functional way!</p>
<h2 id="the-case-for-monads">The Case For Monads<a hidden class="anchor" aria-hidden="true" href="#the-case-for-monads">#</a></h2>
<p>For now, you can think of a monad as a strict interface that defines how you can read from/write to state in your computations. The monad defines what operations are permissible and how to chain together stateful computations.</p>
<p>Now, if we can use monads to perform stateful computations, then we can break the guarantees that functional programming gives us (confidence and composability) so why not just use an imperative language with mutable variables?</p>
<p>Monads deal with <em>immutable</em> data structures and define explicitly wh</p>
<h2 id="a-taste-of-category-theory">A Taste of Category Theory<a hidden class="anchor" aria-hidden="true" href="#a-taste-of-category-theory">#</a></h2>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="http://localhost:1313/tags/functionalprogramming/">Functionalprogramming</a></li>
      <li><a href="http://localhost:1313/tags/haskell/">Haskell</a></li>
      <li><a href="http://localhost:1313/tags/monads/">Monads</a></li>
    </ul>
<nav class="paginav">
  <a class="prev" href="http://localhost:1313/posts/hugo/">
    <span class="title">« Prev</span>
    <br>
    <span>Static Site Generation with Hugo</span>
  </a>
  <a class="next" href="http://localhost:1313/posts/demystifying-monads-2/">
    <span class="title">Next »</span>
    <br>
    <span>Demystifying Monads - Part 2/3</span>
  </a>
</nav>


<ul class="share-buttons">
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Demystifying Monads - Part 1/3 on x"
            href="https://x.com/intent/tweet/?text=Demystifying%20Monads%20-%20Part%201%2f3&amp;url=http%3a%2f%2flocalhost%3a1313%2fposts%2fdemystifying-monads-1%2f&amp;hashtags=functionalprogramming%2chaskell%2cmonads">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M512 62.554 L 512 449.446 C 512 483.97 483.97 512 449.446 512 L 62.554 512 C 28.03 512 0 483.97 0 449.446 L 0 62.554 C 0 28.03 28.029 0 62.554 0 L 449.446 0 C 483.971 0 512 28.03 512 62.554 Z M 269.951 190.75 L 182.567 75.216 L 56 75.216 L 207.216 272.95 L 63.9 436.783 L 125.266 436.783 L 235.9 310.383 L 332.567 436.783 L 456 436.783 L 298.367 228.367 L 432.367 75.216 L 371.033 75.216 Z M 127.633 110 L 164.101 110 L 383.481 400.065 L 349.5 400.065 Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Demystifying Monads - Part 1/3 on linkedin"
            href="https://www.linkedin.com/shareArticle?mini=true&amp;url=http%3a%2f%2flocalhost%3a1313%2fposts%2fdemystifying-monads-1%2f&amp;title=Demystifying%20Monads%20-%20Part%201%2f3&amp;summary=Demystifying%20Monads%20-%20Part%201%2f3&amp;source=http%3a%2f%2flocalhost%3a1313%2fposts%2fdemystifying-monads-1%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-288.985,423.278l0,-225.717l-75.04,0l0,225.717l75.04,0Zm270.539,0l0,-129.439c0,-69.333 -37.018,-101.586 -86.381,-101.586c-39.804,0 -57.634,21.891 -67.617,37.266l0,-31.958l-75.021,0c0.995,21.181 0,225.717 0,225.717l75.02,0l0,-126.056c0,-6.748 0.486,-13.492 2.474,-18.315c5.414,-13.475 17.767,-27.434 38.494,-27.434c27.135,0 38.007,20.707 38.007,51.037l0,120.768l75.024,0Zm-307.552,-334.556c-25.674,0 -42.448,16.879 -42.448,39.002c0,21.658 16.264,39.002 41.455,39.002l0.484,0c26.165,0 42.452,-17.344 42.452,-39.002c-0.485,-22.092 -16.241,-38.954 -41.943,-39.002Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Demystifying Monads - Part 1/3 on reddit"
            href="https://reddit.com/submit?url=http%3a%2f%2flocalhost%3a1313%2fposts%2fdemystifying-monads-1%2f&title=Demystifying%20Monads%20-%20Part%201%2f3">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-3.446,265.638c0,-22.964 -18.616,-41.58 -41.58,-41.58c-11.211,0 -21.361,4.457 -28.841,11.666c-28.424,-20.508 -67.586,-33.757 -111.204,-35.278l18.941,-89.121l61.884,13.157c0.756,15.734 13.642,28.29 29.56,28.29c16.407,0 29.706,-13.299 29.706,-29.701c0,-16.403 -13.299,-29.702 -29.706,-29.702c-11.666,0 -21.657,6.792 -26.515,16.578l-69.105,-14.69c-1.922,-0.418 -3.939,-0.042 -5.585,1.036c-1.658,1.073 -2.811,2.761 -3.224,4.686l-21.152,99.438c-44.258,1.228 -84.046,14.494 -112.837,35.232c-7.468,-7.164 -17.589,-11.591 -28.757,-11.591c-22.965,0 -41.585,18.616 -41.585,41.58c0,16.896 10.095,31.41 24.568,37.918c-0.639,4.135 -0.99,8.328 -0.99,12.576c0,63.977 74.469,115.836 166.33,115.836c91.861,0 166.334,-51.859 166.334,-115.836c0,-4.218 -0.347,-8.387 -0.977,-12.493c14.564,-6.47 24.735,-21.034 24.735,-38.001Zm-119.474,108.193c-20.27,20.241 -59.115,21.816 -70.534,21.816c-11.428,0 -50.277,-1.575 -70.522,-21.82c-3.007,-3.008 -3.007,-7.882 0,-10.889c3.003,-2.999 7.882,-3.003 10.885,0c12.777,12.781 40.11,17.317 59.637,17.317c19.522,0 46.86,-4.536 59.657,-17.321c3.016,-2.999 7.886,-2.995 10.885,0.008c3.008,3.011 3.003,7.882 -0.008,10.889Zm-5.23,-48.781c-16.373,0 -29.701,-13.324 -29.701,-29.698c0,-16.381 13.328,-29.714 29.701,-29.714c16.378,0 29.706,13.333 29.706,29.714c0,16.374 -13.328,29.698 -29.706,29.698Zm-160.386,-29.702c0,-16.381 13.328,-29.71 29.714,-29.71c16.369,0 29.689,13.329 29.689,29.71c0,16.373 -13.32,29.693 -29.689,29.693c-16.386,0 -29.714,-13.32 -29.714,-29.693Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Demystifying Monads - Part 1/3 on facebook"
            href="https://facebook.com/sharer/sharer.php?u=http%3a%2f%2flocalhost%3a1313%2fposts%2fdemystifying-monads-1%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-106.468,0l0,-192.915l66.6,0l12.672,-82.621l-79.272,0l0,-53.617c0,-22.603 11.073,-44.636 46.58,-44.636l36.042,0l0,-70.34c0,0 -32.71,-5.582 -63.982,-5.582c-65.288,0 -107.96,39.569 -107.96,111.204l0,62.971l-72.573,0l0,82.621l72.573,0l0,192.915l-191.104,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Demystifying Monads - Part 1/3 on whatsapp"
            href="https://api.whatsapp.com/send?text=Demystifying%20Monads%20-%20Part%201%2f3%20-%20http%3a%2f%2flocalhost%3a1313%2fposts%2fdemystifying-monads-1%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-58.673,127.703c-33.842,-33.881 -78.847,-52.548 -126.798,-52.568c-98.799,0 -179.21,80.405 -179.249,179.234c-0.013,31.593 8.241,62.428 23.927,89.612l-25.429,92.884l95.021,-24.925c26.181,14.28 55.659,21.807 85.658,21.816l0.074,0c98.789,0 179.206,-80.413 179.247,-179.243c0.018,-47.895 -18.61,-92.93 -52.451,-126.81Zm-126.797,275.782l-0.06,0c-26.734,-0.01 -52.954,-7.193 -75.828,-20.767l-5.441,-3.229l-56.386,14.792l15.05,-54.977l-3.542,-5.637c-14.913,-23.72 -22.791,-51.136 -22.779,-79.287c0.033,-82.142 66.867,-148.971 149.046,-148.971c39.793,0.014 77.199,15.531 105.329,43.692c28.128,28.16 43.609,65.592 43.594,105.4c-0.034,82.149 -66.866,148.983 -148.983,148.984Zm81.721,-111.581c-4.479,-2.242 -26.499,-13.075 -30.604,-14.571c-4.105,-1.495 -7.091,-2.241 -10.077,2.241c-2.986,4.483 -11.569,14.572 -14.182,17.562c-2.612,2.988 -5.225,3.364 -9.703,1.12c-4.479,-2.241 -18.91,-6.97 -36.017,-22.23c-13.314,-11.876 -22.304,-26.542 -24.916,-31.026c-2.612,-4.484 -0.279,-6.908 1.963,-9.14c2.016,-2.007 4.48,-5.232 6.719,-7.847c2.24,-2.615 2.986,-4.484 4.479,-7.472c1.493,-2.99 0.747,-5.604 -0.374,-7.846c-1.119,-2.241 -10.077,-24.288 -13.809,-33.256c-3.635,-8.733 -7.327,-7.55 -10.077,-7.688c-2.609,-0.13 -5.598,-0.158 -8.583,-0.158c-2.986,0 -7.839,1.121 -11.944,5.604c-4.105,4.484 -15.675,15.32 -15.675,37.364c0,22.046 16.048,43.342 18.287,46.332c2.24,2.99 31.582,48.227 76.511,67.627c10.685,4.615 19.028,7.371 25.533,9.434c10.728,3.41 20.492,2.929 28.209,1.775c8.605,-1.285 26.499,-10.833 30.231,-21.295c3.732,-10.464 3.732,-19.431 2.612,-21.298c-1.119,-1.869 -4.105,-2.99 -8.583,-5.232Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Demystifying Monads - Part 1/3 on telegram"
            href="https://telegram.me/share/url?text=Demystifying%20Monads%20-%20Part%201%2f3&amp;url=http%3a%2f%2flocalhost%3a1313%2fposts%2fdemystifying-monads-1%2f">
            <svg version="1.1" xml:space="preserve" viewBox="2 2 28 28" height="30px" width="30px" fill="currentColor">
                <path
                    d="M26.49,29.86H5.5a3.37,3.37,0,0,1-2.47-1,3.35,3.35,0,0,1-1-2.47V5.48A3.36,3.36,0,0,1,3,3,3.37,3.37,0,0,1,5.5,2h21A3.38,3.38,0,0,1,29,3a3.36,3.36,0,0,1,1,2.46V26.37a3.35,3.35,0,0,1-1,2.47A3.38,3.38,0,0,1,26.49,29.86Zm-5.38-6.71a.79.79,0,0,0,.85-.66L24.73,9.24a.55.55,0,0,0-.18-.46.62.62,0,0,0-.41-.17q-.08,0-16.53,6.11a.59.59,0,0,0-.41.59.57.57,0,0,0,.43.52l4,1.24,1.61,4.83a.62.62,0,0,0,.63.43.56.56,0,0,0,.4-.17L16.54,20l4.09,3A.9.9,0,0,0,21.11,23.15ZM13.8,20.71l-1.21-4q8.72-5.55,8.78-5.55c.15,0,.23,0,.23.16a.18.18,0,0,1,0,.06s-2.51,2.3-7.52,6.8Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Demystifying Monads - Part 1/3 on ycombinator"
            href="https://news.ycombinator.com/submitlink?t=Demystifying%20Monads%20-%20Part%201%2f3&u=http%3a%2f%2flocalhost%3a1313%2fposts%2fdemystifying-monads-1%2f">
            <svg version="1.1" xml:space="preserve" width="30px" height="30px" viewBox="0 0 512 512" fill="currentColor"
                xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape">
                <path
                    d="M449.446 0C483.971 0 512 28.03 512 62.554L512 449.446C512 483.97 483.97 512 449.446 512L62.554 512C28.03 512 0 483.97 0 449.446L0 62.554C0 28.03 28.029 0 62.554 0L449.446 0ZM183.8767 87.9921H121.8427L230.6673 292.4508V424.0079H281.3328V292.4508L390.1575 87.9921H328.1233L256 238.2489z" />
            </svg>
        </a>
    </li>
</ul>

  </footer>
</article>
    </main>
    
<footer class="footer">
        <span>&copy; 2024 <a href="http://localhost:1313/">Sophie Bosio</a></span> · 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
